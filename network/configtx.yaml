# configtx.yaml
# Defines the structure of the genesis block and channel configuration transactions

---
################################################################################
#
#   Organizations
#
################################################################################
Organizations:
  - &OrdererOrg
      Name: OrdererOrg
      ID: OrdererMSP
      MSPDir: crypto-config/ordererOrganizations/example.com/msp
      Policies:
        Readers:
          Type: Signature
          Rule: "OR('OrdererMSP.member')"
        Writers:
          Type: Signature
          Rule: "OR('OrdererMSP.member')"
        Admins:
          Type: Signature
          Rule: "OR('OrdererMSP.admin')"
      OrdererEndpoints:
        - orderer0.example.com:7050
        - orderer1.example.com:7050
        - orderer2.example.com:7050

  - &TrafficOrg
      Name: TrafficMSP
      ID: TrafficMSP
      MSPDir: crypto-config/peerOrganizations/traffic.example.com/msp
      Policies:
        Readers:
          Type: Signature
          Rule: "OR('TrafficMSP.admin', 'TrafficMSP.peer', 'TrafficMSP.client')"
        Writers:
          Type: Signature
          Rule: "OR('TrafficMSP.admin', 'TrafficMSP.client')"
        Admins:
          Type: Signature
          Rule: "OR('TrafficMSP.admin')"
        Endorsement:
          Type: Signature
          Rule: "OR('TrafficMSP.peer')"
      AnchorPeers:
        - Host: peer0.traffic.example.com
          Port: 7051

  - &CityHallOrg
      Name: CityHallMSP
      ID: CityHallMSP
      MSPDir: crypto-config/peerOrganizations/cityhall.example.com/msp
      Policies:
        Readers:
          Type: Signature
          Rule: "OR('CityHallMSP.admin', 'CityHallMSP.peer', 'CityHallMSP.client')"
        Writers:
          Type: Signature
          Rule: "OR('CityHallMSP.admin', 'CityHallMSP.client')"
        Admins:
          Type: Signature
          Rule: "OR('CityHallMSP.admin')"
        Endorsement:
          Type: Signature
          Rule: "OR('CityHallMSP.peer')"
      AnchorPeers:
        - Host: peer0.cityhall.example.com
          Port: 8051

  - &PoliceOrg
      Name: PoliceMSP
      ID: PoliceMSP
      MSPDir: crypto-config/peerOrganizations/police.example.com/msp
      Policies:
        Readers:
          Type: Signature
          Rule: "OR('PoliceMSP.admin', 'PoliceMSP.peer', 'PoliceMSP.client')"
        Writers:
          Type: Signature
          Rule: "OR('PoliceMSP.admin', 'PoliceMSP.client')"
        Admins:
          Type: Signature
          Rule: "OR('PoliceMSP.admin')"
        Endorsement:
          Type: Signature
          Rule: "OR('PoliceMSP.peer')"
      AnchorPeers:
        - Host: peer0.police.example.com
          Port: 9051

  - &EmergencyOrg
      Name: EmergencyMSP
      ID: EmergencyMSP
      MSPDir: crypto-config/peerOrganizations/emergency.example.com/msp
      Policies:
        Readers:
          Type: Signature
          Rule: "OR('EmergencyMSP.admin', 'EmergencyMSP.peer', 'EmergencyMSP.client')"
        Writers:
          Type: Signature
          Rule: "OR('EmergencyMSP.admin', 'EmergencyMSP.client')"
        Admins:
          Type: Signature
          Rule: "OR('EmergencyMSP.admin')"
        Endorsement:
          Type: Signature
          Rule: "OR('EmergencyMSP.peer')"
      AnchorPeers:
        - Host: peer0.emergency.example.com
          Port: 10051

################################################################################
#
#   Capabilities
#
################################################################################
Capabilities:
  Channel: &ChannelCapabilities
    V2_0: true
  Orderer: &OrdererCapabilities
    V2_0: true
  Application: &ApplicationCapabilities
    V2_0: true

################################################################################
#
#   Application
#
################################################################################
Application: &ApplicationDefaults
  Organizations:
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"
    LifecycleEndorsement:
      Type: ImplicitMeta
      Rule: "MAJORITY Endorsement"
    Endorsement:
      Type: ImplicitMeta
      Rule: "MAJORITY Endorsement"
  Capabilities:
    <<: *ApplicationCapabilities

################################################################################
#
#   Orderer
#
################################################################################
Orderer: &OrdererDefaults
  OrdererType: etcdraft
  Addresses:
    - orderer0.example.com:7050
    - orderer1.example.com:7050
    - orderer2.example.com:7050

  EtcdRaft:
    Consenters:
      - Host: orderer0.example.com
        Port: 7050
        ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt
        ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt
      - Host: orderer1.example.com
        Port: 7050
        ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt
        ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt
      - Host: orderer2.example.com
        Port: 7050
        ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt
        ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt
    
    # Raft configuration options
    Options:
      TickInterval: 500ms
      ElectionTick: 10
      HeartbeatTick: 1
      MaxInflightBlocks: 5
      SnapshotIntervalSize: 16 MB

  # Batch Timeout: The amount of time to wait before creating a batch
  BatchTimeout: 2s

  # Batch Size: Controls the number of messages batched into a block
  BatchSize:
    MaxMessageCount: 500
    AbsoluteMaxBytes: 10 MB
    PreferredMaxBytes: 2 MB

  Organizations:
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"
    BlockValidation:
      Type: ImplicitMeta
      Rule: "ANY Writers"
  Capabilities:
    <<: *OrdererCapabilities

################################################################################
#
#   Channel
#
################################################################################
Channel: &ChannelDefaults
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"
  Capabilities:
    <<: *ChannelCapabilities

################################################################################
#
#   Profiles
#
################################################################################
Profiles:
  # Genesis block profile for orderer
  TrafficOrdererGenesis:
    <<: *ChannelDefaults
    Orderer:
      <<: *OrdererDefaults
      Organizations:
        - *OrdererOrg
      Capabilities:
        <<: *OrdererCapabilities
    Consortiums:
      TrafficConsortium:
        Organizations:
          - *TrafficOrg
          - *CityHallOrg
          - *PoliceOrg
          - *EmergencyOrg

  # Profile for traffic-channel (all 4 organizations)
  TrafficChannel:
    Consortium: TrafficConsortium
    <<: *ChannelDefaults
    Application:
      <<: *ApplicationDefaults
      Organizations:
        - *TrafficOrg
        - *CityHallOrg
        - *PoliceOrg
        - *EmergencyOrg
      Capabilities:
        <<: *ApplicationCapabilities

  # Profile for admin-channel (3 organizations: Traffic, CityHall, Police)
  AdminChannel:
    Consortium: TrafficConsortium
    <<: *ChannelDefaults
    Application:
      <<: *ApplicationDefaults
      Organizations:
        - *TrafficOrg
        - *CityHallOrg
        - *PoliceOrg
      Capabilities:
        <<: *ApplicationCapabilities
